import { FeatureLike } from 'ol/Feature';

import { BaseLayerKey, VectorLayerKey } from '@frontend/stores/map';

const geodataBaseUrl = 'https://geodata.tampere.fi/geoserver';

const createWfsParams = (typeName: string, projectionCode: string) => {
  return new URLSearchParams({
    service: 'WFS',
    request: 'GetFeature',
    typeName: typeName,
    srsname: projectionCode,
    exceptions: 'application/json',
    outputFormat: 'application/json',
  });
};

export interface WFSLayer {
  id: VectorLayerKey;
  title: string;
  name: string;
  visible: boolean;
  type: 'wfs';
  url: string;
  style: {
    strokeColor: string;
    strokeWidth?: number;
    fillColor: string;
    fillOpacity: number;
    label?: (feature: FeatureLike) => string;
    font?: `${'Bold' | 'Normal'} ${number}px/${number} ${string}`;
  };
  attributions?: string[];
}

interface WMTSLayer {
  id: BaseLayerKey;
  title: string;
  name: string;
  visible: boolean;
  type: 'base';
  options: {
    protocol: 'wmts';
    url: string;
    layer: string;
    matrixSet: string;
    projection: string;
    format: string;
    tileGridID: string;
    tileSize: number;
    zoomLevels: number;
    zoomFactor: number;
  };
  opacity: number;
  attributions: string[];
}

/**
 * Options used to initialize (OpenLayers) Map -component
 */
export const mapOptions = {
  tre: {
    defaultZoom: 8,
    minZoom: 8,
    maxZoom: 17,
    center: [327000, 6822500],
    extent: [313753, 6812223, 351129, 6861143],
  },
  projection: {
    code: 'EPSG:3067',
    extent: [
      50199.4813825220335275, 5698259.8706227578222752, 2147351.4813825218006968,
      7795411.8706227578222752,
    ],
    units: 'm' as const,
    proj4String: '+proj=utm +zone=35 +ellps=GRS80 +units=m +no_defs',
  },
  baseMaps: [
    {
      id: 'virastokartta',
      title: 'Virastokartta',
      name: 'Virastokartta',
      visible: true,
      type: 'base',
      options: {
        protocol: 'wmts',
        url: '/proxy/georaster/gwc/service/wmts?service=WMTS',
        layer: 'georaster:virastokartta_vari_EPSG_3067',
        matrixSet: 'JHS',
        projection: 'EPSG:3067',
        format: 'image/png',
        tileGridID: 'JHS',
        tileSize: 256,
        zoomLevels: 16,
        zoomFactor: 2,
      },
      opacity: 1.0,
      attributions: [],
    },
    {
      id: 'opaskartta',
      title: 'Opaskartta',
      name: 'Opaskartta',
      visible: true,
      type: 'base',
      options: {
        protocol: 'wmts',
        url: '/proxy/georaster/gwc/service/wmts?service=WMTS',
        layer: 'georaster:opaskartta_EPSG_3067',
        matrixSet: 'JHS',
        projection: 'EPSG:3067',
        format: 'image/png',
        tileGridID: 'JHS',
        tileSize: 256,
        zoomLevels: 16,
        zoomFactor: 2,
      },
      opacity: 1.0,
      attributions: [],
    },
    {
      id: 'kantakartta',
      title: 'Kantakartta',
      name: 'Kantakartta',
      visible: true,
      type: 'base',
      options: {
        protocol: 'wmts',
        url: '/proxy/georaster/gwc/service/wmts?service=WMTS',
        layer: 'georaster:kantakartta_mml_harmaa_EPSG_3067',
        matrixSet: 'JHS',
        projection: 'EPSG:3067',
        format: 'image/png',
        tileGridID: 'JHS',
        tileSize: 256,
        zoomLevels: 16,
        zoomFactor: 2,
      },
      opacity: 1.0,
      attributions: [],
    },
    {
      id: 'ilmakuva',
      title: 'Ilmakuva',
      name: 'Ilmakuva',
      visible: true,
      type: 'base',
      options: {
        protocol: 'wmts',
        url: '/proxy/georaster/gwc/service/wmts?service=WMTS',
        layer: 'georaster:2011v_tre_EPSG_3067',
        matrixSet: 'JHS',
        projection: 'EPSG:3067',
        format: 'image/png',
        tileGridID: 'JHS',
        tileSize: 256,
        zoomLevels: 16,
        zoomFactor: 2,
      },
      opacity: 1.0,
      attributions: [],
    },
    {
      id: 'asemakaava',
      title: 'Asemakaava',
      name: 'Asemakaava',
      visible: true,
      type: 'base',
      options: {
        protocol: 'wmts',
        url: '/proxy/georaster/gwc/service/wmts?service=WMTS',
        layer: 'georaster:ajantasa_asemakaava_EPSG_3067',
        matrixSet: 'JHS',
        projection: 'EPSG:3067',
        format: 'image/png',
        tileGridID: 'JHS',
        tileSize: 256,
        zoomLevels: 16,
        zoomFactor: 2,
      },
      opacity: 1.0,
      attributions: [],
    },
  ] as WMTSLayer[],
  wfsLayers: [
    {
      id: 'kaupunginosat',
      title: 'Kaupunginosat',
      name: 'Kaupunginosat',
      visible: true,
      type: 'wfs',
      url: `${geodataBaseUrl}/hallinnolliset_yksikot/wfs?${createWfsParams(
        'hallinnolliset_yksikot:KH_TILASTO',
        'EPSG:3067',
      )}`,
      style: {
        strokeColor: '#00000',
        fillColor: 'rgba(255, 255, 255, 0)',
        label: (feature) => feature.get('NIMI'),
        font: 'Bold 12px/1 Verdana',
      },
    },
    {
      id: 'kiinteistot',
      title: 'Kiinteistöt',
      name: 'Kiinteistöt',
      visible: true,
      type: 'wfs',
      url: `${geodataBaseUrl}/kiinteistot/wfs?${createWfsParams(
        'kiinteistot:KIINTEISTOT_ALUE_JULKINEN_GSVIEW',
        'EPSG:3067',
      )}`,
      style: {
        strokeColor: '#ff0000',
        fillColor: 'rgba(255, 0, 0, 0.1)',
      },
      attributions: [],
    },
    {
      id: 'rakennukset',
      title: 'Rakennukset',
      name: 'Rakennukset',
      visible: true,
      type: 'wfs',
      url: `${geodataBaseUrl}/julkinen/wfs?${createWfsParams(
        'julkinen:RAKENNUKSET_ALUE_MVIEW',
        'EPSG:3067',
      )}`,
      style: {
        strokeColor: '#000000',
        fillColor: '#999999',
      },
    },
    {
      id: 'kadut',
      title: 'Kadut',
      name: 'Kadut',
      visible: true,
      type: 'wfs',
      url: `${geodataBaseUrl}/locus/wfs?${createWfsParams(
        'locus:Katualueen_osa_katu_RpaStreetPart_Polygon_gsview',
        'EPSG:3067',
      )}`,
      style: {
        strokeColor: '#0000ff',
        fillColor: '#ffffff',
      },
    },
    {
      id: 'kevyenliikenteenvaylat',
      title: 'Kevyen liikenteen väylät',
      name: 'Kevyen liikenteen väylät',
      visible: true,
      type: 'wfs',
      url: `${geodataBaseUrl}/locus/wfs?${createWfsParams(
        'locus:Katualueen_osa_klv_RpaStreetPart_Polygon_gsview',
        'EPSG:3067',
      )}`,
      style: {
        strokeColor: '#000000',
        strokeWidth: 2,
        fillColor: '#ffffff',
      },
    },
  ] as WFSLayer[],
};

export const treMunicipalityGeometry = {
  type: 'FeatureCollection',
  name: 'tampere_aluejako_mml_100k_epsg_3067',
  crs: { type: 'name', properties: { name: 'urn:ogc:def:crs:EPSG::3067' } },
  features: [
    {
      type: 'Feature',
      geometry: {
        type: 'MultiPolygon',
        coordinates: [
          [
            [
              [336661.298000407055952, 6857626.499993362464011],
              [341807.049000276951119, 6854120.845994958654046],
              [345820.889000203460455, 6854665.7039959365502],
              [346626.256000190391205, 6854536.2179961130023],
              [346495.272000190452673, 6852674.889996100217104],
              [347619.359000168507919, 6847783.318996378220618],
              [345583.680000197433401, 6845897.272995963692665],
              [345988.470000190020073, 6844856.124996061436832],
              [346639.203000177338254, 6842378.68299622181803],
              [346613.166000175639056, 6840354.592996233142912],
              [345801.078000185196288, 6837771.884996083565056],
              [346042.250000180734787, 6836963.747996143065393],
              [347257.028000162099488, 6836031.876996401697397],
              [347270.109000162105076, 6836030.210996404290199],
              [346408.013000173610635, 6835320.644996235147119],
              [345474.086000187089667, 6834846.404996041208506],
              [343617.47500021615997, 6833670.782995630055666],
              [341142.142000255873427, 6828986.064995069056749],
              [341176.051000255160034, 6828958.937995076179504],
              [341289.852000253158621, 6829049.414995105937123],
              [341390.758000251080375, 6829023.545995132997632],
              [341405.909000250510871, 6828839.669995138421655],
              [341375.538000251399353, 6828801.831995128653944],
              [341168.224000255460851, 6828851.522995075210929],
              [341073.544000257330481, 6828856.085995050147176],
              [338856.579000297409948, 6824709.013994496315718],
              [339131.423000288195908, 6822540.722994599491358],
              [338974.0320002916269, 6822466.487994557246566],
              [338854.89200029411586, 6822431.285994525067508],
              [338505.90300030191429, 6822449.030994422733784],
              [338465.477000302867964, 6822516.846994408406317],
              [338403.228000304079615, 6822449.922994392924011],
              [338307.31600030651316, 6822616.994994365610182],
              [338185.319000309624244, 6822653.658994327299297],
              [338043.072000312386081, 6822484.380994289182127],
              [338043.013000312377699, 6822484.392994288355112],
              [337925.236000315169804, 6822509.280994254164398],
              [337889.318000316154212, 6822658.76399424020201],
              [337785.709000318660401, 6822664.653994210064411],
              [337684.161000321269967, 6822789.902994177304208],
              [337267.898000331304502, 6822913.082994051277637],
              [337125.051000334089622, 6822602.014994012191892],
              [336872.950000339071266, 6821804.978993945755064],
              [336948.794000337016769, 6821681.885993969626725],
              [336912.895000337040983, 6821190.849993963725865],
              [336985.731000335130375, 6821147.911993988789618],
              [336797.080000339308754, 6820831.259993933141232],
              [336851.768000337760895, 6820771.505993952043355],
              [336804.929000338423066, 6820496.589993942528963],
              [336634.512000342423562, 6820373.937993890605867],
              [336732.845000339497346, 6820123.913993924856186],
              [336635.897000341792591, 6819914.671993896365166],
              [336681.035000340430997, 6819827.319993913173676],
              [336640.396000341279432, 6819765.553993900306523],
              [336628.258000341011211, 6819473.710993900895119],
              [336427.641000346106011, 6819420.01499383803457],
              [336482.224000344169326, 6819128.140993860550225],
              [336188.632000350917224, 6818774.24699377361685],
              [335642.151000361773185, 6817053.182993622496724],
              [334665.689000385056715, 6815700.401993324048817],
              [334112.121000397601165, 6814346.135993158444762],
              [333087.571000427007675, 6814434.782992796041071],
              [331425.689000478538219, 6814673.859992181882262],
              [330545.508000507601537, 6814802.11199183575809],
              [330479.335000509861857, 6814764.65999181009829],
              [330333.566000514780171, 6814739.241991750895977],
              [330148.884000521036796, 6814733.778991677798331],
              [329943.27700052811997, 6814696.757991595193744],
              [329786.424000533879735, 6814912.768991527147591],
              [327513.337000619154423, 6815227.088990545831621],
              [326191.538000673055649, 6815267.875989932566881],
              [326049.909000679908786, 6815525.717989861033857],
              [325851.472000689711422, 6816029.220989753492177],
              [325792.276000695128459, 6817027.09798970259726],
              [325895.093000690685585, 6817023.309989751316607],
              [325889.141000691219233, 6817114.553989748470485],
              [325779.295000695914496, 6817121.688989693298936],
              [325730.716000699321739, 6817527.191989660263062],
              [325275.823000722448342, 6818624.489989412017167],
              [325596.231000708707143, 6818743.682989568449557],
              [325671.760000705602579, 6818785.896989602595568],
              [325555.788000711123459, 6818970.213989542797208],
              [325580.263000711449422, 6819396.714989545755088],
              [325331.841000723536126, 6819790.134989412501454],
              [325212.897000729222782, 6819910.98198935110122],
              [325202.89300073008053, 6820054.586989343166351],
              [325250.102000728424173, 6820188.549989363178611],
              [325656.919000712921843, 6821088.744989543221891],
              [324724.414000756223686, 6821487.32298906520009],
              [324587.738000761601143, 6821197.997989002615213],
              [324084.84900078427745, 6820860.83098875079304],
              [322578.090000861557201, 6821620.491987919434905],
              [319633.759001020982396, 6820693.771986210718751],
              [319401.318001037929207, 6821431.05898604542017],
              [318831.891001074051019, 6821797.769985668361187],
              [318515.954001096484717, 6822464.608985443599522],
              [317263.558001177967526, 6822525.446984604001045],
              [317378.957001171947923, 6822914.636984669603407],
              [317340.547001174883917, 6823009.283984639681876],
              [317374.689001173246652, 6823128.753984658047557],
              [317437.156001169001684, 6823113.317984702065587],
              [317619.588001159369014, 6823732.920984805561602],
              [316754.117001223494299, 6825030.581984162330627],
              [316192.010001272312365, 6827073.220983690582216],
              [316346.723001261008903, 6826984.727983804419637],
              [316363.648001259600278, 6826959.919983817264438],
              [316429.621001254883595, 6826950.089983863756061],
              [316486.715001250617206, 6826869.929983905516565],
              [316492.54100124980323, 6826791.027983915992081],
              [316572.566001243889332, 6826712.045983972027898],
              [316569.336001243849751, 6826643.320983975194395],
              [316467.247001250449102, 6826558.346983904950321],
              [316530.774001245445106, 6826443.190983953885734],
              [316652.949001237051561, 6826444.528984040953219],
              [316711.46400123310741, 6826498.952984080649912],
              [316788.558001227909699, 6826506.933984135277569],
              [316838.201001223991625, 6826377.157984172925353],
              [316913.99300121847773, 6826355.51398422755301],
              [317003.146001211833209, 6826223.836984294466674],
              [317100.642001205473207, 6826291.852984360419214],
              [317270.642001193715259, 6826230.48498447984457],
              [317341.860001189168543, 6826226.303984529338777],
              [317359.395001187338494, 6826139.99398454464972],
              [317434.995001182192937, 6826156.603984598070383],
              [317514.65800117678009, 6826102.291984654031694],
              [317594.750001171254553, 6826075.081984708085656],
              [317704.588001163676381, 6825983.248984786681831],
              [317672.555001165601425, 6825922.102984766475856],
              [317775.868001158640254, 6825900.733984838239849],
              [317848.182001153589226, 6825852.466984889470041],
              [317934.515001148160081, 6825882.37798494566232],
              [317902.566001149418298, 6825725.56598492898047],
              [317979.481001144042239, 6825637.37698498275131],
              [318052.545001139456872, 6825650.274985034950078],
              [318163.173001131857745, 6825535.092985109426081],
              [318219.987001127796248, 6825464.054985148832202],
              [318272.268001123913564, 6825334.016985187307],
              [318224.945001126732677, 6825263.966985158622265],
              [318400.367001114413142, 6825031.512985283508897],
              [319504.269001048640348, 6825748.775985973887146],
              [321475.941000936087221, 6826114.402987165376544],
              [321747.843000921653584, 6826245.412987317889929],
              [321677.008000926231034, 6826398.915987274609506],
              [322014.8790009082295, 6826499.50698746740818],
              [322082.372000904055312, 6826409.061987505294383],
              [322154.808000900549814, 6826444.928987546823919],
              [323154.009000852820463, 6827710.864988073706627],
              [323235.761000847443938, 6827380.853988128714263],
              [323730.249000822019298, 6827254.823988399468362],
              [323661.447000824846327, 6827056.424988368526101],
              [324229.301000796840526, 6826943.492988673038781],
              [324570.873000780469738, 6826990.256988852284849],
              [324970.212000762869138, 6827347.746989049017429],
              [325805.610000723623671, 6827013.039989477023482],
              [327966.045000632642768, 6827198.091990496963263],
              [327538.50100067013409, 6834564.223990138620138],
              [326508.716000728483777, 6839352.752989534288645],
              [326475.325000737677328, 6841903.800989457406104],
              [326823.44000072684139, 6843578.069989589974284],
              [328468.675000657327473, 6843983.317990364506841],
              [329843.464000612264499, 6847842.864990902133286],
              [329109.082000644120853, 6848874.89199055172503],
              [328719.611000664532185, 6850546.463990336284041],
              [329318.968000644934364, 6852300.3469905750826],
              [328876.407000663806684, 6852673.619990363717079],
              [329180.858000652457122, 6853072.286990496329963],
              [329479.549000640166923, 6853086.699990629218519],
              [330370.153000609716401, 6854871.348990989848971],
              [331469.92900056950748, 6855405.786991448141634],
              [331875.759000561898574, 6858435.142991559579968],
              [334465.339000477222726, 6859985.050992547534406],
              [336661.298000407055952, 6857626.499993362464011],
            ],
          ],
        ],
      },
    },
  ],
};
